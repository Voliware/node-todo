Object.setProperties=function(e,t){for(let s in t)e.hasOwnProperty(s)&&(e[s]=t[s]);return e},Object.isEmpty=function(e){return!Object.keys(e).length},Object.extend=function(){let e=arguments[0];if(e)for(let t=1;t<arguments.length;t++){let s=arguments[t];if("object"==typeof s)for(let t in s)if(s.hasOwnProperty(t)){let r=s[t];if(void 0===r)continue;"object"==typeof e[t]&&"object"==typeof r&&e[t]!==r?Object.extend(e[t],r):e[t]=r}}return e},Object.flatten=function(e){var t={};for(var s in e)if(e.hasOwnProperty(s))if("object"==typeof e[s]&&null!==e[s]){var r=Object.flatten(e[s]);for(var n in r)r.hasOwnProperty(n)&&(t[s+"."+n]=r[n])}else t[s]=e[s];return t},Object.unflatten=function(e){let t={};for(let s in e){let r=s.split(".");r.reduce(function(t,n,a){return t[n]||(t[n]=isNaN(Number(r[a+1]))?r.length-1==a?e[s]:{}:[])},t)}return t},String.random=function(e){for(var t,s="";s.length<e;)s+=(t=Math.floor(62*Math.random()))<10?t:t<36?String.fromCharCode(t+55):String.fromCharCode(t+61);return s},document.getElementsByDataName=function(e){return document.querySelectorAll(`[data-name="${e}"]`)},document.getElementByDataName=function(e){let t=document.getElementsByDataName(e);return t.length?t[0]:null};class EventSystem{constructor(){return this.events={},this}getHandlersCount(e){let t=this.events[e];if(!t)return 0;let s=0,r=[];for(r.push(t);r.length>0;){let e=r.pop();for(let t in e)"_handlers"===t?s+=e[t].length:"object"==typeof e[t]&&r.push(e[t])}return s}on(e,t){let s=e.split("."),r=this.events;for(let e=0;e<s.length;e++){let n=s[e];r[n]||(r[n]={}),e===s.length-1?(Array.isArray(r[n]._handlers)||(r[n]._handlers=[]),r[n]._handlers.push(t)):r=r[n]}return this}one(e,t){let s=this,r=e+"."+String.random(8);return this.on(r,function(e){t(e),s.off(r)}),this}off(e,t=!0){let s=e.split("."),r=this.events;for(let e=0;e<s.length;e++){let n=s[e];e===s.length-1?t?delete r[n]:(delete r[n]._handlers,0===Object.keys(r[n]).length&&delete r[n]):r=r[n]}return this}emit(e,t){let s=e.split("."),r=this.events;for(let e=0;e<s.length;e++){if(!(r=r[s[e]]))return this;if(e===s.length-1){let e=[];for(e.push(r);e.length;){let s=e.pop();for(let r in s)if("_handlers"===r)for(let e=0;e<s[r].length;e++)s[r][e](t);else e.push(s[r])}}}return this}}class ElementManager extends EventSystem{constructor(e,t,s){super(),this.options=Object.extend({primaryKey:"id",maxElements:0,cloneTemplate:!0,removeTemplate:!0,removeDeadTemplates:!0},s),this.wrapper=e,this.template=this.options.cloneTemplate?t.cloneNode(!0):t,this.template.removeAttribute("id"),this.template.classList.remove("template"),this.elements=new Map,this.options.removeTemplate&&t.remove(),this.cachedData=null,this.processedRenderData=null}cacheData(e){return Object.extend({},e)}processRenderData(e){return e}getElementCount(){return this.elements.size}empty(){for(;this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild);this.elements=new Map,this.emit("empty")}attachElementHandlers(e){}cloneTemplate(){let e=this.template.cloneNode(!0);return this.attachElementHandlers(e),this.emit("clone",e),e}appendElement(e){this.wrapper.appendChild(e),this.emit("append",e)}appendElementBefore(e,t){t.before(e)}appendElementAfter(e,t){t.after(e)}removeElement(e){let t=this.elements.get(e);t&&(this.wrapper.removeChild(t),this.elements.delete(e),this.emit("remove",t))}removeDeadElements(e){for(let[t,s]of this.elements)this.getData(e,t)||(s.remove(),this.elements.delete(t),this.emit("remove",s))}getDataType(e){return e instanceof Map?"map":Array.isArray(e)?"array":"object"==typeof e?"object":null}getData(e,t){switch(this.getDataType(e)){case"array":let s=e.filter(e=>e[this.options.primaryKey]===t);return s&&s.length?s[0]:null;case"map":return e.get(t);case"object":return e[t];default:return null}}render(e){switch(this.cachedData=this.cacheData(e),this.processedRenderData=this.processRenderData(e),this.getDataType(e)){case"array":this.renderArray(e);break;case"map":this.renderMap(e);break;default:case"object":this.renderObject(e)}this.options.removeDeadTemplates&&this.removeDeadElements(e)}renderArray(e){for(let t=0;t<e.length;t++){let s=e[t][this.options.primaryKey];if(void 0===s)return void console.error("ElementManager.renderArray: data must have a primary key property");this.renderElement(s,e[t],t)}}renderMap(e){let t=0;for(let[s,r]of e)this.renderElement(s,r,t),t++}renderObject(e){let t=0;for(let s in e)this.renderElement(s,e[s],t),t++}renderSingle(e,t){let s={};s[e]=t,this.render(s)}renderElement(e,t,s){let r=!1,n=this.elements.get(e);n||(r=!0,n=this.cloneTemplate()),n&&(n.cachedData=Object.extend({},t),this.appendElement(n),n instanceof Template?n.render(t):Template.render(n,t),r&&this.elements.set(e,n))}static dataArrayToDataObject(e,t="id"){let s={};for(let r=0;r<e.length;r++){let n=e[r][t];void 0===n?console.error(`dataArrayToDataObject: object does not have required "${t}" value`):s[n]=e[r]}return s}}const Status={none:"none",error:"error",success:"success",processing:"processing",info:"info",warning:"warning",class:{}};Status.class[Status.none]="status-none",Status.class[Status.error]="status-error",Status.class[Status.success]="status-success",Status.class[Status.processing]="status-processing",Status.class[Status.info]="status-info",Status.class[Status.warning]="status-warning",Status.classArray=[Status.class.none,Status.class.error,Status.class.success,Status.class.processing,Status.class.info,Status.class.warning],Status.bgclass={},Status.bgclass[Status.none]="status-bg-none",Status.bgclass[Status.error]="status-bg-error",Status.bgclass[Status.success]="status-bg-success",Status.bgclass[Status.processing]="status-bg-processing",Status.bgclass[Status.info]="status-bg-info",Status.bgclass[Status.warning]="status-bg-warning",Status.bgclassArray=[Status.bgclass.none,Status.bgclass.error,Status.bgclass.success,Status.bgclass.processing,Status.bgclass.info,Status.bgclass.warning],Status.icon={},Status.icon[Status.none]="",Status.icon[Status.error]="",Status.icon[Status.info]="",Status.icon[Status.processing]='<div class="spinner-container"><div class="spinner-wheel"></div></div>',Status.icon[Status.success]="",Status.icon[Status.warning]="";class Template extends HTMLElement{constructor(e={}){super(),this.options=Object.extend({elements:{},renderAttribute:"data-name",displayBlock:!0},e),this.eventSystem=new EventSystem,this.nativeEvents={},this.elements={},this.cachedData={},this.renderData={},this.isFirstRender=!0}connectedCallback(){this.options.displayBlock&&this.classList.add("template-block");let e=this.createHtml();"string"==typeof e&&(e=e.trim(),this.setHtml(e)),this.findNamedElements(),this.findElements(this.options.elements),this.onConnected()}onConnected(){}createHtml(){return null}setOptions(e){for(let t in e)this.options.hasOwnProperty(t)&&(this.options[t]=e[t])}static addEventSystem(e){e.eventSystem=new EventSystem,e.nativeEvents={}}static on(e,t,s){let r=t.split(".")[0];e.eventSystem||Template.addEventSystem(e),0===e.eventSystem.getHandlersCount(r)&&(e.nativeEvents[r]=function(t){e.eventSystem.emit(r,t)},e.addEventListener(r,e.nativeEvents[r])),e.eventSystem.on(t,s)}on(e,t){return Template.on(this,e,t),this}static one(e,t,s){let r=t.split(".")[0];e.eventSystem||Template.addEventSystem(e),0===e.eventSystem.getHandlersCount(r)&&(e.nativeEvents[r]=function(t){e.eventSystem.emit(r,t),e.removeEventListener(r,e.nativeEvents[r])},e.addEventListener(r,e.nativeEvents[r])),e.eventSystem.one(t,s)}one(e,t){return Template.one(this,e,t),this}static off(e,t,s=!0){if(!(e.eventSystem instanceof EventSystem))return;let r=t.split(".")[0];e.eventSystem.off(t,s),0===e.eventSystem.getHandlersCount(r)&&e.removeEventListener(r,e.nativeEvents[r])}off(e,t=!0){return Template.off(this,e,t),this}static emit(e,t,s){e.eventSystem instanceof EventSystem&&e.eventSystem.emit(t,s)}emit(e,t){return Template.emit(this,e,t),this}setAttributes(e){for(let t=0;t<e.length;t++){let s=e[t];this.setAttribute(s.name,s.value)}return this}static findElements(e,t){"object"!=typeof e.elements&&(e.elements={});for(let s in t)e.elements[s]=e.querySelector(t[s]);return e.elements}findElements(e){return Template.findElements(this,e)}static findNamedElements(e,t="data-name"){let s={},r=e.querySelectorAll(`[name], [${t}]`);for(let e=0;e<r.length;e++){let n=r[e].getAttribute("name");n||(n=r[e].getAttribute(t)),n&&(s[n]?(Array.isArray(s[n])||(s[n]=[s[n]]),s[n].push(r[e])):s[n]=r[e])}return s}findNamedElements(){let e=Template.findNamedElements(this,this.options.renderAttribute);Object.extend(this.elements,e)}getElements(){return this.elements}static select(e,t){return"string"==typeof e&&(t=e,e=document.documentElement),e.querySelectorAll(t)}select(e){return Template.select(this,e)}static selectFirst(e,t){let s=Template.select(e,t);return s instanceof NodeList?s[0]:null}selectFirst(e){return Template.selectFirst(this,e)}static selectLast(e,t){let s=Template.select(e,t);return s instanceof NodeList?s[e.length-1]:null}selectLast(e){return Template.selectLast(e)}static append(e,t){t.appendChild(e)}append(e){return Template.append(e,this),this}appendTo(e){return Template.append(this,e),this}static prepend(e,t){t.insertBefore(e,t.firstChild)}prepend(e){return Template.prepend(e,this),this}prependTo(e){return Template.prepend(this,e),this}static empty(e){for(;this.element;)e.removeChild(e.firstChild)}empty(){return Template.empty(this),this}static isVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}isVisible(){return Template.isVisible(this)}static hide(e){"none"!==e.style.display&&(e._previousDisplay_=e.style.display),e.style.display="none"}hide(){return Template.hide(this),this}static show(e){e.style.display=e._previousDisplay_||"block"}show(){return Template.show(this),this}static display(e,t){return void 0===t&&(t=!Template.isVisible(e)),t?Template.show(e):Template.hide(e)}display(e){return Template.display(this,e),this}static getStyle(e,t){return window.getComputedStyle(e).getPropertyValue(t)}getStyle(e){return Template.getStyle(this,e)}static setHeight(e,t){"number"==typeof t&&(t+="px"),e.style.height=t}setHeight(e){return Template.setHeight(this,e),this}static setWidth(e,t){"number"==typeof t&&(t+="px"),e.style.width=t}setWidth(e){return Template.setWidth(this,e),this}static addClass(e,t){e.classList.add(t)}addClass(e){return Template.addClass(this,e),this}static hasClass(e,t){return e.classList.contains(t)}hasClass(e){return Template.hasClass(this,e)}static removeClass(e,t){e.classList.remove(t)}removeClass(e){return Template.removeClass(this,e),this}static replaceClass(e,t,s){e.classList.replace(t,s)}replaceClass(e,t){return Template.replaceClass(this,e,t),this}static toggleClass(e,t,s){e.classList.toggle(t,s)}toggleClass(e,t){return Template.toggleClass(this,e,t),this}static getValue(e){return e.value}getValue(){return Template.getValue(this)}static setValue(e,t){e.value=t}setValue(e){return Template.setValue(this,e),this}static enable(e){e.disabled=!1}enable(){return Template.enable(this),this}static disable(e){e.disabled=!0}disable(){return Template.disable(this),this}cacheData(e){return this.cachedData=Object.extend({},e)}processRenderData(e){return this.renderData=e}static setHtml(e,t){e.innerHTML=t}setHtml(e){return Template.setHtml(this,e),this}static render(e,t,s=!1){let r=null;r=s?e.getElements():Template.findNamedElements(e);let n=Object.flatten(t);for(let t in n){let a=n[t],i=r[t];if(i||(s&&(e.findNamedElements(),i=r[t]),i))if(i.render)i.render(a);else{Array.isArray(i)||(i=[i]);for(let e=0;e<i.length;e++){let t=i[e];if("false"!==t.getAttribute("data-render"))if("INPUT"===t.tagName){let e=t.getAttribute("type");e?"checkbox"===e&&a?t.checked=!0:"radio"===e?t.getAttribute("value")===a&&(t.checked=!0):t.value=a:t.value=a}else"SELECT"===t.tagName?t.value=a:t.innerHTML=a}}}}render(e){return this.cachedData=this.cacheData(e),this.renderData=this.processRenderData(Object.extend({},e)),Template.render(this,this.renderData,!0),this.isFirstRender=!1,this}static clone(e){let t=e.cloneNode();return t.innerHTML=e.innerHTML,t}clone(){return Template.clone(this)}}customElements.define("template-element",Template);class FeedbackTemplate extends Template{static get observedAttributes(){return["status","text"]}constructor(e={}){super(Object.extend({elements:{icon:".feedback-icon",text:".feedback-text",close:".feedback-close"}},e))}onConnected(){this.attachButtonHandlers()}attachButtonHandlers(){let e=this;this.elements.close.addEventListener("click",function(){e.hide()})}attributeChangedCallback(e,t,s){if("status"===e){let e=Status.class.none,t=Status.icon.none;s&&""!==s&&void 0!==Status.bgclass[s]&&(e=Status.bgclass[s],t=Status.icon[s]),this.setClass(e),this.setIcon(t)}else"text"===e&&this.setText(s)}setStatus(e){this.setAttribute("status",e)}clearStatusClass(){this.classList.remove(...Status.bgclassArray)}setClass(e){this.clearStatusClass(),this.classList.add(e)}setText(e){this.elements.text.textContent=e}setIcon(e){this.elements.icon.innerHTML=e}render(e,t,s){this.setStatus(e),this.setText(t),this.setIcon(s)}renderError(e){this.render(Status.error,e,Status.icon[Status.error])}renderInfo(e){this.render(Status.info,e,Status.icon[Status.error])}renderProcessing(e){this.render(Status.processing,e,Status.icon[Status.processing])}renderSuccess(e){this.render(Status.success,e,Status.icon[Status.success])}renderWarning(e){this.render(Status.warning,e,Status.icon[Status.warning])}}customElements.define("template-feedback",FeedbackTemplate);class FormTemplate extends Template{constructor(e={}){let t={getRequest:null,submitRequest:null,validateRequest:null,checkboxMode:FormTemplate.checkboxMode.number,serializeMode:FormTemplate.serializeMode.toObject,excludedFields:["disabled"],elements:{form:"form",footer:".form-footer",reset:'[type="reset"]',submit:'[type="submit"]'}};super(Object.extend(t,e)),this.serializedData={},this.formattedSerializedData=null}onConnected(){this.attachFormHandlers()}attachFormHandlers(){let e=this;this.elements.form.addEventListener("submit",function(t){t.preventDefault(),e.submit()}),this.elements.form.addEventListener("reset",function(t){t.preventDefault(),e.reload()})}displayFooter(e){Template.display(this.elements.footer,e)}reset(){this.elements.form.reset()}reload(){Object.isEmpty(this.cachedData)?this.reset():this.render(this.cachedData)}validate(){return!0}convertCheckbox(e,t){let s=e.checked;switch(t){case FormTemplate.checkboxMode.boolean:return s;case FormTemplate.checkboxMode.string:return s?"1":"0";case FormTemplate.checkboxMode.onOff:return s?"on":"off";default:case FormTemplate.checkboxMode.number:return s?1:0}}isNotExcluded(e){for(let t=0;t<this.options.excludedFields.length;t++)if("disabled"===this.options.excludedFields[t]&&e.hasAttribute("disabled"))return!1;return!0}serialize(){this.serializedData={};let e=Array.from(this.getElementsByTagName("input")),t=Array.from(this.getElementsByTagName("select")),s=Array.from(this.getElementsByTagName("textarea")),r=e.concat(t,s);for(let e=0;e<r.length;e++)this.isNotExcluded(r[e])&&this.serializeInput(r[e]);return this.serializedData}serializeInput(e){let t=e.getAttribute("name"),s=null;switch(e.getAttribute("type")){case"checkbox":s=this.convertCheckbox(e,this.options.checkboxMode);break;case"radio":if(!e.checked)return null;s=e.value;break;case"file":e.files.length>0&&(s=e.files[0]);break;case"number":s=Number(e.value);break;default:s=e.value}return this.serializedData[t]=s}serializeTextarea(e){return this.serializeSelect(e)}serializeSelect(e){let t=e.getAttribute("name");return this.serializedData[t]=e.value}formatSerializedData(e,t){switch(t){case FormTemplate.serializeMode.toString:return this.serializedDataToString(e);default:case FormTemplate.serializeMode.toObject:return this.serializedData=Object.unflatten(this.serializedData),this.serializedData}}serializedDataToString(e){let t="",s=0,r=Object.keys(e).length;for(let n in e)t+=n+"="+e[n],s++<r-1&&(t+="&");return t}async submit(){this.serializedData=this.serialize(),this.formattedSerializedData=this.formatSerializedData(this.serializedData,this.options.serializeMode);try{let e=await this.options.submitRequest(this.formattedSerializedData);200===e.status?this.emit("success",e.body):this.emit("fail",e.body)}catch(e){this.emit("error",e)}}}FormTemplate.checkboxMode={boolean:0,number:1,string:2,onOff:3},FormTemplate.serializeMode={toString:0,toOrderedString:1,toObject:2,toValue:3},customElements.define("template-form",FormTemplate);class PagerTemplate extends Template{constructor(e){super(e),this.page=1,this.pageCount=1}onConnected(){this.attachButtonHandlers()}setPageCount(e){return this.pageCount=e,this.render(),this}setPage(e){return this.page=e,this.render(),this}render(e={}){return void 0===e.pageCount&&(e.pageCount=this.pageCount),void 0===e.page&&(e.page=this.page),super.render(e),e.pageCount<=1?(this.disableNextButton(),this.disablePreviousButton()):e.page===e.pageCount?(this.disableNextButton(),this.enablePreviousButton()):1===e.page?(this.disablePreviousButton(),this.enableNextButton()):(this.enableNextButton(),this.enablePreviousButton()),this}displayNextButton(e){return Template.display(this.elements.next,e),this}displayPreviousButton(){return Template.display(this.elements.previous,state),this}enableNextButton(){return Template.enable(this.elements.next),this}disableNextButton(){return Template.disable(this.elements.next),this}enablePreviousButton(){return Template.enable(this.elements.previous),this}disablePreviousButton(){return Template.disable(this.elements.previous),this}attachButtonHandlers(){let e=this;Template.on(this.elements.next,"click.pager",function(){e.setPage(e.page+1),e.emit("next")}),Template.on(this.elements.previous,"click.pager",function(){e.setPage(e.page-1),e.emit("previous")});let t=null;return Template.on(this.elements.page,"input.pager",function(){clearTimeout(t),t=setTimeout(function(){let t=parseInt(e.elements.page.value);t&&t<=e.pageCount&&(e.page=t,e.emit("page",e.page))},150)}),this}}customElements.define("template-pager",PagerTemplate);class PopupTemplate extends Template{constructor(e={}){super(Object.extend({displayBlock:!1,showHeader:!0,showClose:!0,showFooter:!0,elements:{header:".popup-header",title:".popup-title",close:".popup-close",body:".popup-body",footer:".popup-footer"}},e))}onConnected(){this.applyOptions(this.options),this.attachButtonHandlers()}attachButtonHandlers(){let e=this;this.elements.close.addEventListener("click",function(t){e.close()})}applyOptions(e){!e.showHeader&&this.elements.header&&this.elements.header.remove(),!e.showClose&&this.elements.close&&this.elements.close.remove(),!e.showFooter&&this.elements.footer&&this.elements.footer.remove()}open(){document.body.classList.add("popup-open"),this.show()}close(){document.body.classList.remove("popup-open"),this.hide()}renderTitle(e){this.elements.title.innerHTML=e}renderBody(e){this.elements.body.innerHTML=e}renderFooter(e){this.elements.footer.innerHTML=e}}customElements.define("template-popup",PopupTemplate);class StatusTemplate extends Template{static get observedAttributes(){}constructor(e){super(e)}onConnected(){this.hasAttribute("status")||this.setAttribute("status",Status.none),this.hasAttribute("text")||this.setAttribute("text","")}attributeChangedCallback(e,t,s){if("status"===e){let e=Status.class.none;s&&""!==s&&void 0!==Status.class[s]&&(e=Status.class[s]),this.setClass(e)}else"text"===e&&this.setText(s)}setStatus(e){this.setAttribute("status",e)}clearStatusClass(){this.classList.remove(...Status.classArray)}setClass(e){this.clearStatusClass(),this.classList.add(e)}setText(e){this.textContent=e}render(e,t){this.setStatus(e),this.setText(t)}renderNone(e){this.render(Status.none,e)}renderError(e){this.render(Status.error,e)}renderSuccess(e){this.render(Status.success,e)}renderInfo(e){this.render(Status.info,e)}renderWarning(e){this.render(Status.warning,e)}}customElements.define("template-status",StatusTemplate);class TableTemplate extends Template{constructor(e={}){super(Object.extend({alwaysRebuild:!1,elements:{table:"table",thead:"thead",theadTr:"thead > tr",tbody:"tbody",tfoot:"tfoot",tr:"tbody > tr"},schema:{primaryKey:"id",columns:[],columnTitles:[]}},e)),this.rowManager=null}onConnected(){this.rowManager=new ElementManager(this.elements.tbody,this.elements.tr),this.elements.tr.remove()}render(e){this.cacheData(e),this.processRenderData(e),this.options.alwaysRebuild?this.empty():Array.isArray(this.renderData)&&void 0===this.renderData[0][this.options.primaryKey]&&this.empty(),this.rowManager.render(this.renderData)}empty(){this.rowManager.empty()}}customElements.define("template-table",TableTemplate);class WizardTemplate extends FormTemplate{constructor(e={}){super(Object.extend({elements:{navs:".wizard-navs",tabs:".wizard-tabs",pager:"template-pager"}},e)),this.tabCount=0,this.tab=0}onConnected(){this.tabCount=this.elements.tabs.children.length,this.elements.pager.setPage(1),this.elements.pager.setPageCount(this.tabCount),this.attachNavHandlers(),this.attachPagerHandlers(),this.goToFirstTab()}isValidTabIndex(e){return e>-1&&e<this.tabCount}displayTab(e,t){if(this.isValidTabIndex(e)){let s=this.elements.tabs.children[e];Template.display(s,t)}}hideTabs(){for(let e=0;e<this.tabCount;e++)this.displayTab(e,!1)}goToTab(e){this.isValidTabIndex(e)&&(this.hideTabs(),this.displayTab(e,!0),this.tab=e,this.elements.pager.setPage(e+1),this.emit("tab.show",e))}goToFirstTab(){this.goToTab(0)}goToLastTab(){this.goToTab(this.tabCount-1)}goToNextTab(){this.tab<this.tabCount-1&&(this.tab++,this.goToTab(this.tab))}goToPreviousTab(){this.tab>0&&(this.tab--,this.goToTab(this.tab))}attachPagerHandlers(){let e=this;this.elements.pager.on("next",function(){e.goToNextTab()}),this.elements.pager.on("previous",function(){e.goToPreviousTab()}),this.elements.pager.on("page",function(t){e.goToTab(t-1)})}attachNavHandlers(){let e=this;for(let t=0;t<this.tabCount;t++){let s=this.elements.navs.children[t];Template.on(s,"click.wizard",function(){e.goToTab(t)})}}renderPager(){this.elements.pager.setPage(this.tab+1),this.elements.pager.setPageCount(this.tabCount)}validateTab(e){this.isValidTabIndex(e)}}customElements.define("template-wizard",WizardTemplate);class Routes{static getUsers(){return fetch("/users").catch(e=>{console.error(e)})}static getUser(e){return fetch(`/user/${e}`).catch(e=>{console.error(e)})}static addUser({username:e,email:t,password:s}){let r=JSON.stringify({username:e,email:t,password:s});return fetch("/user",{method:"post",body:r}).catch(e=>{console.error(e)})}static deleteUser(e){return fetch(`/user/${e}`,{method:"delete"}).catch(e=>{console.error(e)})}static updateUser({username:e,email:t,password:{older:s,newer:r}}){let n=JSON.stringify({username:e,email:t,password:{older:s,newer:r}});return fetch("/user",{method:"put",body:n}).catch(e=>{console.error(e)})}static login({username:e,password:t}){let s=JSON.stringify({username:e,password:t});return fetch("/user/login",{method:"post",body:s}).catch(e=>{console.error(e)})}static loginWithCookie(){return fetch("/user/login",{method:"post"}).catch(e=>{console.error(e)})}static logout(){return fetch("/user/logout",{method:"post"}).catch(e=>{console.error(e)})}static register({username:e,email:t,password:s}){let r=JSON.stringify({username:e,email:t,password:s});return fetch("/user/register",{method:"post",body:r}).catch(e=>{console.error(e)})}static resetPassword({email:e}){let t=JSON.stringify({email:e});return fetch("/user/reset",{method:"post",body:t}).catch(e=>{console.error(e)})}}class LoginForm extends FormTemplate{constructor(){return super({submitRequest:Routes.login}),this}}customElements.define("template-user-login",LoginForm);class RegisterForm extends FormTemplate{constructor(){return super({submitRequest:Routes.register}),this}}customElements.define("template-user-register",RegisterForm);class ResetForm extends FormTemplate{constructor(){return super({submitRequest:Routes.resetPassword}),this}}customElements.define("template-user-reset",ResetForm);class User{constructor(){return this.username="",this.id=0,this.email="",this}}class UserTemplate extends Template{constructor(){return super({elements:{avatar:'[data-name="avatar"]',name:'[data-name="name"]',email:'[data-name="email"]',logout:'[name="logout"]'}}),this}attachHandlers(){return Template.on(this.elements.logout,"click",()=>{this.emit("logout")}),this}}customElements.define("template-user",UserTemplate);class UserApp extends Template{constructor(){super(),this.wrapper=Template.selectFirst("template-user-app"),this.feedback=Template.selectFirst("template-feedback"),this.loginForm=Template.selectFirst("template-user-login"),this.registerForm=Template.selectFirst("template-user-register"),this.resetForm=Template.selectFirst("template-user-reset"),this.loginLink=Template.selectFirst(".user-login-link"),this.registerLink=Template.selectFirst(".user-register-link"),this.resetPasswordLink=Template.selectFirst(".user-reset-link"),this.user=new User,this.userElement=Template.selectFirst("template-user"),this.userElement.on("logout",()=>{this.logout()}),this.attachLoginFormHandlers(),this.attachRegisterFormHandlers(),this.attachResetFormHandlers(),Template.on(this.loginLink,"click",()=>{this.displayComponent("login"),this.displayLinks("login")}),Template.on(this.resetPasswordLink,"click",()=>{this.displayComponent("reset"),this.displayLinks("reset")}),Template.on(this.registerLink,"click",()=>{this.displayComponent("register"),this.displayLinks("register")})}attachLoginFormHandlers(){this.loginForm.on("success",()=>{this.displayComponent("logout"),this.feedback.renderSuccess("Logged in successfully"),this.feedback.show()}),this.loginForm.on("fail",()=>{this.feedback.renderError("Failed to login"),this.feedback.show()})}attachRegisterFormHandlers(){this.registerForm.on("success",()=>{this.displayComponent("logout"),this.feedback.renderSuccess("Registered successfully"),this.feedback.show()}),this.registerForm.on("fail",()=>{this.feedback.renderError("Failed to register"),this.feedback.show()})}attachResetFormHandlers(){this.resetForm.on("success",()=>{this.feedback.renderSuccess("Reset password successfully"),this.feedback.show()}),this.resetForm.on("fail",()=>{this.feedback.renderError("Failed to reset password"),this.feedback.show()})}setUserData(e){this.user.set(e)}render(e){this.userElement.render(e)}display(e){Template.display(this.wrapper,e)}displayComponent(e){switch(e){case"reset":this.displayForm("reset"),this.displayLinks("reset");break;case"register":this.displayForm("register"),this.displayLinks("register");break;case"logout":this.displayForm("logout"),this.displayLinks("logout");break;case"login":default:this.displayForm("login"),this.displayLinks("login")}}displayForm(e){switch(e){case"reset":this.loginForm.hide(),this.registerForm.hide(),this.userElement.hide(),this.resetForm.show();break;case"register":this.resetForm.hide(),this.loginForm.hide(),this.userElement.hide(),this.registerForm.show();break;case"logout":this.loginForm.hide(),this.registerForm.hide(),this.resetForm.hide(),this.userElement.show();break;case"login":default:this.resetForm.hide(),this.registerForm.hide(),this.userElement.hide(),this.loginForm.show()}}displayLinks(e){switch(e){case"register":Template.hide(this.registerLink),Template.show(this.resetPasswordLink),Template.show(this.loginLink);break;case"reset":Template.hide(this.resetPasswordLink),Template.show(this.loginLink),Template.show(this.registerLink);break;case"logout":Template.hide(this.registerLink),Template.hide(this.resetPasswordLink),Template.hide(this.loginLink);break;case"login":default:Template.hide(this.loginLink),Template.show(this.registerLink),Template.show(this.resetPasswordLink)}}async loginWithCookie(){200===(await Routes.loginWithCookie()).status?(this.displayComponent("logout"),this.emit("login.cookie.success")):(this.displayComponent("login"),this.emit("login.cookie.fail"))}async logout(){200===(await Routes.logout()).status&&this.displayComponent("login")}initialize(){return this.loginWithCookie()}}customElements.define("template-user-app",UserApp),function(e){var t=!1;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var s=window.Cookies,r=window.Cookies=e();r.noConflict=function(){return window.Cookies=s,r}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var s=arguments[e];for(var r in s)t[r]=s[r]}return t}return function t(s){function r(t,n,a){var i;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(a=e({path:"/"},r.defaults,a)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*a.expires),a.expires=o}a.expires=a.expires?a.expires.toUTCString():"";try{i=JSON.stringify(n),/^[\{\[]/.test(i)&&(n=i)}catch(t){}n=s.write?s.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var l="";for(var c in a)a[c]&&(l+="; "+c,!0!==a[c]&&(l+="="+a[c]));return document.cookie=t+"="+n+l}t||(i={});for(var u=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,h=0;h<u.length;h++){var p=u[h].split("="),m=p.slice(1).join("=");this.json||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var f=p[0].replace(d,decodeURIComponent);if(m=s.read?s.read(m,f):s(m,f)||m.replace(d,decodeURIComponent),this.json)try{m=JSON.parse(m)}catch(t){}if(t===f){i=m;break}t||(i[f]=m)}catch(t){}}return i}}return(r.set=r).get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,s){r(t,"",e(s,{expires:-1}))},r.withConverter=t,r}(function(){})});var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,s){if(s.get||s.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=s.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.symbolCounter_=0,$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++},$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.arrayIterator=function(e){var t=0;return $jscomp.iteratorPrototype(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.array=$jscomp.array||{},$jscomp.iteratorFromArray=function(e,t){$jscomp.initSymbolIterator(),e instanceof String&&(e+="");var s=0,r={next:function(){if(s<e.length){var n=s++;return{value:t(n,e[n]),done:!1}}return r.next=function(){return{done:!0,value:void 0}},r.next()}};return r[Symbol.iterator]=function(){return r},r},$jscomp.polyfill=function(e,t,s,r){if(t){for(s=$jscomp.global,e=e.split("."),r=0;r<e.length-1;r++){var n=e[r];n in s||(s[n]={}),s=s[n]}(t=t(r=s[e=e[e.length-1]]))!=r&&null!=t&&$jscomp.defineProperty(s,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.keys",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");var $jscomp$this=this;!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.anime=t()}(this,function(){function e(e){if(!D.col(e))try{return document.querySelectorAll(e)}catch(e){}}function t(e,t){for(var s=e.length,r=2<=arguments.length?arguments[1]:void 0,n=[],a=0;a<s;a++)if(a in e){var i=e[a];t.call(r,i,a,e)&&n.push(i)}return n}function s(e){return e.reduce(function(e,t){return e.concat(D.arr(t)?s(t):t)},[])}function r(t){return D.arr(t)?t:(D.str(t)&&(t=e(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function n(e,t){return e.some(function(e){return e===t})}function a(e){var t,s={};for(t in e)s[t]=e[t];return s}function i(e,t){var s,r=a(e);for(s in e)r[s]=t.hasOwnProperty(s)?t[s]:e[s];return r}function o(e,t){var s,r=a(e);for(s in t)r[s]=D.und(e[s])?t[s]:e[s];return r}function l(e){if(e=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e))return e[2]}function c(e,t){return D.fnc(e)?e(t.target,t.id,t.total):e}function u(e,t){if(t in e.style)return getComputedStyle(e).getPropertyValue(t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase())||"0"}function d(e,t){return D.dom(e)&&n(j,t)?"transform":D.dom(e)&&(e.getAttribute(t)||D.svg(e)&&e[t])?"attribute":D.dom(e)&&"transform"!==t&&u(e,t)?"css":null!=e[t]?"object":void 0}function h(e,s){switch(d(e,s)){case"transform":return function(e,s){var r=function(e){return-1<e.indexOf("translate")||"perspective"===e?"px":-1<e.indexOf("rotate")||-1<e.indexOf("skew")?"deg":void 0}(s);if(r=-1<s.indexOf("scale")?1:0+r,!(e=e.style.transform))return r;for(var n=[],a=[],i=[],o=/(\w+)\((.+?)\)/g;n=o.exec(e);)a.push(n[1]),i.push(n[2]);return(e=t(i,function(e,t){return a[t]===s})).length?e[0]:r}(e,s);case"css":return u(e,s);case"attribute":return e.getAttribute(s)}return e[s]||0}function p(e,t){var s=/^(\*=|\+=|-=)/.exec(e);if(!s)return e;var r=l(e)||0;switch(t=parseFloat(t),e=parseFloat(e.replace(s[0],"")),s[0][0]){case"+":return t+e+r;case"-":return t-e+r;case"*":return t*e+r}}function m(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function f(e){e=e.points;for(var t,s=0,r=0;r<e.numberOfItems;r++){var n=e.getItem(r);0<r&&(s+=m(t,n)),t=n}return s}function g(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return 2*Math.PI*e.getAttribute("r");case"rect":return 2*e.getAttribute("width")+2*e.getAttribute("height");case"line":return m({x:e.getAttribute("x1"),y:e.getAttribute("y1")},{x:e.getAttribute("x2"),y:e.getAttribute("y2")});case"polyline":return f(e);case"polygon":var t=e.points;return f(e)+m(t.getItem(t.numberOfItems-1),t.getItem(0))}}function b(e,t){function s(s){return s=void 0===s?0:s,e.el.getPointAtLength(1<=t+s?t+s:0)}var r=s(),n=s(-1),a=s(1);switch(e.property){case"x":return r.x;case"y":return r.y;case"angle":return 180*Math.atan2(a.y-n.y,a.x-n.x)/Math.PI}}function y(e,t){var s,r=/-?\d*\.?\d+/g;if(s=D.pth(e)?e.totalLength:e,D.col(s))if(D.rgb(s)){var n=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(s);s=n?"rgba("+n[1]+",1)":s}else s=D.hex(s)?function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,s,r){return t+t+s+s+r+r});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+(e=parseInt(t[1],16))+","+parseInt(t[2],16)+","+(t=parseInt(t[3],16))+",1)"}(s):D.hsl(s)?function(e){function t(e,t,s){return 0>s&&(s+=1),1<s&&--s,s<1/6?e+6*(t-e)*s:.5>s?t:s<2/3?e+(t-e)*(2/3-s)*6:e}var s=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e);e=parseInt(s[1])/360;var r=parseInt(s[2])/100,n=parseInt(s[3])/100;if(s=s[4]||1,0==r)n=r=e=n;else{var a=.5>n?n*(1+r):n+r-n*r,i=2*n-a;n=t(i,a,e+1/3),r=t(i,a,e),e=t(i,a,e-1/3)}return"rgba("+255*n+","+255*r+","+255*e+","+s+")"}(s):void 0;else n=(n=l(s))?s.substr(0,s.length-n.length):s,s=t&&!/\s/g.test(s)?n+t:n;return{original:s+="",numbers:s.match(r)?s.match(r).map(Number):[0],strings:D.str(e)||t?s.split(r):[]}}function v(e){return t(e=e?s(D.arr(e)?e.map(r):r(e)):[],function(e,t,s){return s.indexOf(e)===t})}function T(e,t){var s=a(t);if(D.arr(e)){var n=e.length;2!==n||D.obj(e[0])?D.fnc(t.duration)||(s.duration=t.duration/n):e={value:e}}return r(e).map(function(e,s){return s=s?0:t.delay,e=D.obj(e)&&!D.pth(e)?e:{value:e},D.und(e.delay)&&(e.delay=s),e}).map(function(e){return o(e,s)})}function S(e,t){var s;return e.tweens.map(function(r){var n=(r=function(e,t){var s,r={};for(s in e){var n=c(e[s],t);D.arr(n)&&1===(n=n.map(function(e){return c(e,t)})).length&&(n=n[0]),r[s]=n}return r.duration=parseFloat(r.duration),r.delay=parseFloat(r.delay),r}(r,t)).value,a=h(t.target,e.name),i=s?s.to.original:a,o=(i=D.arr(n)?n[0]:i,p(D.arr(n)?n[1]:n,i));a=l(o)||l(i)||l(a);return r.from=y(i,a),r.to=y(o,a),r.start=s?s.end:e.offset,r.end=r.start+r.delay+r.duration,r.easing=function(e){return D.arr(e)?F.apply(this,e):_[e]}(r.easing),r.elasticity=(1e3-Math.min(Math.max(r.elasticity,1),999))/1e3,r.isPath=D.pth(n),r.isColor=D.col(r.from.original),r.isColor&&(r.round=1),s=r})}function k(e,t,s,r){var n="delay"===e;return t.length?(n?Math.min:Math.max).apply(Math,t.map(function(t){return t[e]})):n?r.delay:s.offset+r.delay+r.duration}function w(e){var r,n=i(E,e),a=i(L,e),l=function(e){var t=v(e);return t.map(function(e,s){return{target:e,id:s,total:t.length}})}(e.targets),c=[],u=o(n,a);for(r in e)u.hasOwnProperty(r)||"targets"===r||c.push({name:r,offset:u.offset,tweens:T(e[r],a)});return e=function(e,r){return t(s(e.map(function(e){return r.map(function(t){var s=d(e.target,t.name);if(s){var r=S(t,e);t={type:s,property:t.name,animatable:e,tweens:r,duration:r[r.length-1].end,delay:r[0].delay}}else t=void 0;return t})})),function(e){return!D.und(e)})}(l,c),o(n,{children:[],animatables:l,animations:e,duration:k("duration",e,n,a),delay:k("delay",e,n,a)})}function x(e){function s(){return window.Promise&&new Promise(function(e){return h=e})}function r(e){return m.reversed?m.duration-e:e}function n(e){for(var s=0,r={},n=m.animations,a=n.length;s<a;){var i=n[s],o=i.animatable,l=(c=i.tweens)[p=c.length-1];p&&(l=t(c,function(t){return e<t.end})[0]||l);for(var c=Math.min(Math.max(e-l.start-l.delay,0),l.duration)/l.duration,d=isNaN(c)?1:l.easing(c,l.elasticity),h=(c=l.to.strings,l.round),p=[],f=void 0,g=(f=l.to.numbers.length,0);g<f;g++){var y=void 0,v=(y=l.to.numbers[g],l.from.numbers[g]);y=l.isPath?b(l.value,d*y):v+d*(y-v);h&&(l.isColor&&2<g||(y=Math.round(y*h)/h)),p.push(y)}if(l=c.length)for(f=c[0],d=0;d<l;d++)h=c[d+1],g=p[d],isNaN(g)||(f=h?f+(g+h):f+(g+" "));else f=p[0];O[i.type](o.target,i.property,f,r,o.id),i.currentValue=f,s++}if(s=Object.keys(r).length)for(n=0;n<s;n++)C||(C=u(document.body,"transform")?"transform":"-webkit-transform"),m.animatables[n].target.style[C]=r[n].join(" ");m.currentTime=e,m.progress=e/m.duration*100}function a(e){m[e]&&m[e](m)}function i(){m.remaining&&!0!==m.remaining&&m.remaining--}function o(e){var t=m.duration,o=m.offset,u=o+m.delay,f=m.currentTime,g=m.reversed,b=r(e);if(m.children.length){var y=m.children,v=y.length;if(b>=m.currentTime)for(var T=0;T<v;T++)y[T].seek(b);else for(;v--;)y[v].seek(b)}(b>=u||!t)&&(m.began||(m.began=!0,a("begin")),a("run")),b>o&&b<t?n(b):(b<=o&&0!==f&&(n(0),g&&i()),(b>=t&&f!==t||!t)&&(n(t),g||i())),a("update"),e>=t&&(m.remaining?(c=l,"alternate"===m.direction&&(m.reversed=!m.reversed)):(m.pause(),m.completed||(m.completed=!0,a("complete"),"Promise"in window&&(h(),p=s()))),d=0)}e=void 0===e?{}:e;var l,c,d=0,h=null,p=s(),m=w(e);return m.reset=function(){var e=m.direction,t=m.loop;for(m.currentTime=0,m.progress=0,m.paused=!0,m.began=!1,m.completed=!1,m.reversed="reverse"===e,m.remaining="alternate"===e&&1===t?2:t,n(0),e=m.children.length;e--;)m.children[e].reset()},m.tick=function(e){l=e,c||(c=l),o((d+l-c)*x.speed)},m.seek=function(e){o(r(e))},m.pause=function(){var e=A.indexOf(m);-1<e&&A.splice(e,1),m.paused=!0},m.play=function(){m.paused&&(m.paused=!1,c=0,d=r(m.currentTime),A.push(m),P||M())},m.reverse=function(){m.reversed=!m.reversed,c=0,d=r(m.currentTime)},m.restart=function(){m.pause(),m.reset(),m.play()},m.finished=p,m.reset(),m.autoplay&&m.play(),m}var C,E={update:void 0,begin:void 0,run:void 0,complete:void 0,loop:1,direction:"normal",autoplay:!0,offset:0},L={duration:1e3,delay:0,easing:"easeOutElastic",elasticity:500,round:0},j="translateX translateY translateZ rotate rotateX rotateY rotateZ scale scaleX scaleY scaleZ skewX skewY perspective".split(" "),D={arr:function(e){return Array.isArray(e)},obj:function(e){return-1<Object.prototype.toString.call(e).indexOf("Object")},pth:function(e){return D.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},dom:function(e){return e.nodeType||D.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return D.hex(e)||D.rgb(e)||D.hsl(e)}},F=function(){function e(e,t,s){return(((1-3*s+3*t)*e+(3*s-6*t))*e+3*t)*e}return function(t,s,r,n){if(0<=t&&1>=t&&0<=r&&1>=r){var a=new Float32Array(11);if(t!==s||r!==n)for(var i=0;11>i;++i)a[i]=e(.1*i,t,r);return function(i){if(t===s&&r===n)return i;if(0===i)return 0;if(1===i)return 1;for(var o=0,l=1;10!==l&&a[l]<=i;++l)o+=.1;l=o+(i-a[--l])/(a[l+1]-a[l])*.1;var c=3*(1-3*r+3*t)*l*l+2*(3*r-6*t)*l+3*t;if(.001<=c){for(o=0;4>o&&0!==(c=3*(1-3*r+3*t)*l*l+2*(3*r-6*t)*l+3*t);++o){var u=e(l,t,r)-i;l=l-u/c}i=l}else if(0===c)i=l;else{l=o,o=o+.1;var d=0;do{0<(c=e(u=l+(o-l)/2,t,r)-i)?o=u:l=u}while(1e-7<Math.abs(c)&&10>++d);i=u}return e(i,s,n)}}}}(),_=function(){function e(e,t){return 0===e||1===e?e:-Math.pow(2,10*(e-1))*Math.sin(2*(e-1-t/(2*Math.PI)*Math.asin(1))*Math.PI/t)}var t,s="Quad Cubic Quart Quint Sine Expo Circ Back Elastic".split(" "),r={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],e],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(t,s){return 1-e(1-t,s)}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(t,s){return.5>t?e(2*t,s)/2:1-e(-2*t+2,s)/2}]},n={linear:F(.25,.25,.75,.75)},a={};for(t in r)a.type=t,r[a.type].forEach(function(e){return function(t,r){n["ease"+e.type+s[r]]=D.fnc(t)?t:F.apply($jscomp$this,t)}}(a)),a={type:a.type};return n}(),O={css:function(e,t,s){return e.style[t]=s},attribute:function(e,t,s){return e.setAttribute(t,s)},object:function(e,t,s){return e[t]=s},transform:function(e,t,s,r,n){r[n]||(r[n]=[]),r[n].push(t+"("+s+")")}},A=[],P=0,M=function(){function e(){P=requestAnimationFrame(t)}function t(t){var s=A.length;if(s){for(var r=0;r<s;)A[r]&&A[r].tick(t),r++;e()}else cancelAnimationFrame(P),P=0}return e}();return x.version="2.2.0",x.speed=1,x.running=A,x.remove=function(e){e=v(e);for(var t=A.length;t--;)for(var s=A[t],r=s.animations,a=r.length;a--;)n(e,r[a].animatable.target)&&(r.splice(a,1),r.length||s.pause())},x.getValue=h,x.path=function(t,s){var r=D.str(t)?e(t)[0]:t,n=s||100;return function(e){return{el:r,property:e,totalLength:g(r)*(n/100)}}},x.setDashoffset=function(e){var t=g(e);return e.setAttribute("stroke-dasharray",t),t},x.bezier=F,x.easings=_,x.timeline=function(e){var t=x(e);return t.pause(),t.duration=0,t.add=function(s){return t.children.forEach(function(e){e.began=!0,e.completed=!0}),r(s).forEach(function(s){var r=o(s,i(L,e||{}));r.targets=r.targets||e.targets,s=t.duration;var n=r.offset;r.autoplay=!1,r.direction=t.direction,r.offset=D.und(n)?s:p(n,s),t.began=!0,t.completed=!0,t.seek(r.offset),(r=x(r)).began=!0,r.completed=!0,r.duration>s&&(t.duration=r.duration),t.children.push(r)}),t.seek(0),t.reset(),t.autoplay&&t.restart(),t},t},x.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},x}),function(e){function t(e,t,s){var r=this;(s=s||{}).open=r.getElm(s.open),s.openEvent=s.openEvent||"click",s.style=Object(s.style),s.style.display=s.style.display||"block",s.closeOnBlur=s.closeOnBlur||!1,s.template=s.template||'<div data-col="{color}" style="background-color: {color}"></div>',r.elm=r.getElm(e),r.cbs=[],r.isOpen=!0,r.colors=t,r.options=s,r.render(),s.open&&s.open.addEventListener(s.openEvent,function(e){r.isOpen?r.close():r.open()}),r.elm.addEventListener("click",function(e){var t=e.target.getAttribute("data-col");t&&(r.set(t),r.close())}),s.closeOnBlur&&window.addEventListener("click",function(e){e.target!=s.open&&e.target!=r.elm&&r.isOpen&&r.close()}),!1!==s.autoclose&&r.close()}t.prototype.getElm=function(e){return"string"==typeof e?document.querySelector(e):e},t.prototype.render=function(){var e=this,t="";e.colors.forEach(function(s){t+=e.options.template.replace(/\{color\}/g,s)}),e.elm.innerHTML=t},t.prototype.close=function(){this.elm.style.display="none",this.isOpen=!1},t.prototype.open=function(){this.elm.style.display=this.options.style.display,this.isOpen=!0},t.prototype.colorChosen=function(e){this.cbs.push(e)},t.prototype.set=function(e,t){var s=this;s.color=e,!1!==t&&s.cbs.forEach(function(t){t.call(s,e)})},e.Piklor=t}(this);class Router{static addTodo(e){let t=JSON.stringify(e);return fetch("/todo",{method:"post",body:t}).catch(e=>{console.error(e)})}static deleteTodo(e){return fetch(`/todo/${e}`,{method:"delete"}).catch(e=>{console.error(e)})}static getTodo(e){return fetch(`/todo/${e}`).catch(e=>{console.error(e)})}static getTodos(){return fetch("/todo").catch(e=>{console.error(e)})}static reparentTodo(e,t){let s=JSON.stringify({parentId:t});return fetch(`/todo/parent/${e}`,{method:"post",body:s}).catch(e=>{console.error(e)})}static setCollapsedState(e,t,s=!1){let r=JSON.stringify({collapsed:t,recursive:s});return fetch(`/todo/collapsed/${e}`,{method:"post",body:r}).catch(e=>{console.error(e)})}static updateTodo(e){let t=JSON.stringify(e);return fetch(`/todo/${e._id}`,{method:"put",body:t}).catch(e=>{console.error(e)})}}class Todo extends Template{constructor(){super({colours:["purple","pink","blue","green","yellow","orange","brown","red","black","grey","white"],elements:{body:".todo-body",form:".todo-form",text_input:'[name="text"]',status_button:'[name="status"]',add_button:'[name="add"]',move_button:'[name="move"]',colour_button:'[name="colour"]',delete_button:'[name="delete"]',collapse_button:'[name="collapse"]',collapse_icon:'[name="collapse"] i',children:".todo-children",colour_picker:".todo-colour-picker"}}),this._id="",this.text="",this.parent_id="",this.status=!1,this.background_colour="white",this.collapsed=!1,this.created=0,this.colour_picker=null}createHtml(){return'\n            <div class="todo" draggable="true">\n                <table class="todo-body">\n                    <tbody>\n                        <tr>\n                            <td class="todo-status">\n                                <button type="button" name="status" class="todo-status" data-render="false">\n                                    <i class="fas fa-check-square"></i>\n                                </button>\n                            </td>\n                            <td class="todo-buttons todo-button-collapse-container">\n                                <div class="flex">\n                                    <button type="button" name="collapse" title="Toggle Children Todos" disabled>\n                                        <i class="fas fa-chevron-up"></i>\n                                    </button>\n                                </div>\n                            </td>\n                            <td class="todo-form">\n                                <input class="todo-input" type="text" name="text"></textarea>\n                            </td>\n                            <td class="todo-buttons">\n                                <div class="flex">\n                                    <button type="button" name="move" title="Move">\n                                        <i class="fas fa-arrows-alt"></i>\n                                    </button>\n                                    <button type="button" name="add" title="Add Child Todo">\n                                        <i class="fas fa-plus"></i>\n                                    </button>\n                                    <button type="button" name="colour" title="Choose Colour">\n                                        <i class="fas fa-palette"></i>\n                                    </button>\n                                    <button type="button" name="delete" title="Delete Todo">\n                                        <i class="fas fa-trash"></i>\n                                    </button>\n                                </div>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n                <div class="todo-colour-picker"></div>\n                <div class="todo-children"></div>\n            </div>\n        '}onConnected(){this.createPiklor(),this.focusTextInput(),this.attachButtonHandlers(),this.attachDragHandlers(),this.attachInputHandlers()}createPiklor(){this.colour_picker=new Piklor(this.elements.colour_picker,this.options.colours,{open:this.elements.colour_button}),this.colour_picker.colorChosen(e=>{this.setBackgroundColour(e),this.removeColourPickerStyle(!1)})}attachDragHandlers(){this.on("dragstart",e=>{e.stopPropagation(),e.dataTransfer.setData("text",this.getId())}),this.on("dragover",e=>{e.stopPropagation(),e.preventDefault()}),this.elements.move_button.addEventListener("dragenter",e=>{e.stopPropagation(),this.enableDragOverStyle(!0)}),this.elements.move_button.addEventListener("dragleave",e=>{e.stopPropagation(),this.enableDragOverStyle(!1)}),this.on("drop",e=>{e.stopPropagation(),e.preventDefault(),this.enableDragOverStyle(!1);let t=e.dataTransfer.getData("text");this.getId()===t||this.isChild(t)||this.isParent(t)||this.emit("reparent",{todoId:t,parentId:this.getId()})})}attachButtonHandlers(){this.elements.add_button.addEventListener("click",()=>{this.addChildTodo()}),this.elements.delete_button.addEventListener("click",()=>{this.delete()}),this.elements.colour_button.addEventListener("click",()=>{}),this.elements.collapse_button.addEventListener("click",()=>{this.toggleCollapse()}),this.elements.status_button.addEventListener("click",()=>{this.toggleStatus()})}attachInputHandlers(){this.elements.text_input.addEventListener("click",e=>{e.stopPropagation(),this.setActive()});let e=null;this.elements.text_input.addEventListener("keydown",t=>{[9,16,17,18,19,20,91,93].includes(t.keyCode)||(clearTimeout(e),e=setTimeout(()=>{this.update()},500))})}focusTextInput(){this.elements.text_input.focus()}addChildTodo(){return Router.addTodo({parent_id:this.getId()}).then(()=>{this.emit("addChild")}).catch(e=>{console.error(e)})}cacheData(e){return void 0===e.collapsed&&(e.collapsed=0),super.cacheData(e)}delete(){return Router.deleteTodo(this.getId()).then(()=>{this.emit("delete"),this.remove()}).catch(e=>{console.error(e)})}getId(){return this.cachedData._id||null}getParentId(){return this.cachedData.parentId||null}getText(){return this.elements.text_input.value}getStatus(){return this.cachedData.status}isChild(e){return!!this.cachedData.children&&this.cachedData.children.indexOf(e)>-1}isParent(e){return this.cachedData.parentId===e}render({parent_id:e="",background_colour:t="white",collapsed:s=0,children:r=[],status:n=Todo.status.incomplete,text:a=""}){super.render(arguments[0]),this.elements.text_input.value=a,this.renderStatus(n),this.renderCollapse(s),this.renderBackgroundColour(t),this.enableCollapsedButton(r.length),""!==e&&this.classList.add("todo-child")}renderActive(){this.replaceClass("inactive","active")}renderInactive(){this.replaceClass("active","inactive")}renderBackgroundColour(e){this.elements.body.style.backgroundColor=e}enableCollapsedButton(e){this.elements.collapse_button.disabled=!e}renderCollapse(e){this.elements.children.style.display=e?"none":"block",this.renderCollapsedIcon(e)}renderCollapsedIcon(e){e?(this.elements.collapse_icon.classList.remove("fa-chevron-up"),this.elements.collapse_icon.classList.add("fa-chevron-down")):(this.elements.collapse_icon.classList.remove("fa-chevron-down"),this.elements.collapse_icon.classList.add("fa-chevron-up"))}renderStatus(e){e===Todo.status.incomplete?(this.elements.body.classList.remove("complete"),this.elements.text_input.classList.remove("complete"),this.elements.status_button.classList.remove("complete")):e===Todo.status.complete&&(this.elements.body.classList.add("complete"),this.elements.text_input.classList.add("complete"),this.elements.status_button.classList.add("complete"))}renderText(e){this.elements.text_input.value=e}removeColourPickerStyle(){this.elements.body.classList.remove("colour-picker-open")}setActive(){this.renderInactive()}setInactive(){this.renderActive()}setBackgroundColour(e){this.renderBackgroundColour(e);let t={_id:this.getId(),background_colour:e};return Router.updateTodo(t).then(()=>{}).catch(e=>{console.log(e)})}setCollapsedState(e,t){return Router.setCollapsedState(this.getId(),e,t).then(()=>{}).catch(e=>{console.error(e)})}setStatus(e){this.cachedData.status=e;let t={_id:this.getId(),status:e};return Router.updateTodo(t).then(()=>{this.renderStatus(e)}).catch(e=>{console.error(e)})}setText(e){this.renderText(e)}toggleCollapse(e=!1){return this.cachedData.collapsed=this.cachedData.collapsed?0:1,this.renderCollapse(this.cachedData.collapsed),this.setCollapsedState(this.cachedData.collapsed,e)}toggleColourPickerStyle(){this.elements.body.classList.toggle("colour-picker-open")}enableDragOverStyle(e){e?this.elements.body.classList.add("todo-drag-over"):this.elements.body.classList.remove("todo-drag-over")}toggleStatus(){return this.cachedData.status=this.cachedData.status?0:1,this.setStatus(this.cachedData.status)}update(){let e={_id:this.getId(),text:this.getText()};return Router.updateTodo(e).then(()=>{this.emit("update")}).catch(e=>{console.error(e)})}}Todo.status={incomplete:0,complete:1},customElements.define("todo-todo",Todo);class TodoManager extends ElementManager{constructor(e){super(e,document.createElement("todo-todo")),e.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()}),e.addEventListener("drop",e=>{let t=e.dataTransfer.getData("text");console.log(t)})}attachElementHandlers(e){e.on("addChild",()=>{this.emit("addChild")}),e.on("delete",()=>{this.emit("delete")}),e.on("reparent",e=>{this.emit("reparent",e)})}appendElement(e){if(e.cachedData.parent_id){let t=this.elements.get(e.cachedData.parent_id);if(t)return void e.appendTo(t.elements.children)}super.appendElement(e)}renderElement(e,t,s){let r=!1,n=this.elements.get(e);n||(r=!0,n=this.cloneTemplate()),n&&(n.cachedData=Object.extend({},t),this.appendElement(n),n instanceof Template?n.render(t):Template.render(n,t),r&&this.elements.set(e,n))}render(e){e=this.sortDataToOrderedMap(e),super.render(e)}sortDataToOrderedMap(e){function t(e,t){for(let s=0;s<t.length;s++){let r=t[s];if(r._id===e)return r}return null}function s(e,s,r){for(let n=0;n<e.length;n++){let a=t(e[n],s);a&&r.set(a._id,a)}}let r=new Map;for(let t=0;t<e.length;t++){let n=e[t];n.parent_id&&""!==n.parent_id||r.get(n._id)||r.set(n._id,n),Array.isArray(n.children)&&n.children.length&&s(n.children,e,r)}return r}}class TodoApp{constructor(){this.wrapper=document.getElementById("app"),this.loader=document.getElementById("loader"),this.user_app_element=document.getElementById("todo-user-app"),this.todo_list=document.getElementById("todo-list"),this.add_todo_button=document.getElementById("todo-add-button"),this.user_app=new UserApp,this.todo_manager=new TodoManager(this.todo_list),this.user_app.on("login.cookie.success",()=>{this.getTodos(),this.displayModule("app")}),this.user_app.on("login.cookie.fail",()=>{this.displayModule("login")}),this.user_app.on("login.success",e=>{this.getTodos(),this.displayModule("app")}),this.user_app.on("login.required",()=>{this.displayModule("login")}),this.user_app.on("logout",()=>{this.displayModule("login")}),this.todo_manager.on("addChild",()=>{this.getTodos()}),this.todo_manager.on("delete",()=>{this.getTodos()}),this.todo_manager.on("reparent",e=>{this.reparentTodo(e.todoId,e.parentId)}),this.todo_manager.on("update",()=>{}),this.add_todo_button.addEventListener("click",()=>{this.addTodo()})}display(e){Template.display(this.wrapper,e)}displayLoader(e){Template.display(this.loader,e)}displayUser(e){Template.display(this.user_app_element,e)}displayModule(e){switch(e){case"loader":this.display(!1),this.displayUser(!1),this.displayLoader(!0);break;case"app":this.displayLoader(!1),this.displayUser(!1),this.display(!0);break;case"login":this.displayLoader(!1),this.display(!1),this.displayUser(!0)}}addTodo(){return Router.addTodo({}).then(()=>{this.getTodos()})}getTodos(){return Router.getTodos().then(e=>e.json()).then(e=>{this.todo_manager.render(e)})}reparentTodo(e,t){return Router.reparentTodo(e,t).then(()=>{this.todo_manager.empty(),this.getTodos()})}initialize(){this.user_app.initialize()}}